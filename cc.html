<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>All-in-One Firebase App</title>
<style>
body { background-color: black; color: silver; font-family: Arial; padding: 20px; }
input, button, textarea { padding: 8px; margin: 5px; border-radius: 5px; }
button { background-color: silver; color: black; border: none; cursor: pointer; }
.section { border: 1px solid silver; padding: 15px; margin: 10px 0; }
.hidden { display: none; }
.blog-card { border:1px solid silver; padding:10px; margin:5px 0; }
a { color: silver; text-decoration:none; }
a:hover { text-decoration: underline; }
</style>
</head>
<body>

<h1>All-in-One Firebase App</h1>

<!-- AUTH SECTION -->
<div class="section" id="auth-section">
  <h2>Login / Signup</h2>
  <input type="email" id="email" placeholder="Email">
  <input type="password" id="password" placeholder="Password">
  <br>
  <button onclick="signup()">Signup</button>
  <button onclick="login()">Login</button>
  <button onclick="resetPassword()">Forgot Password</button>
</div>

<!-- BLOG SECTION -->
<div class="section hidden" id="blog-section">
  <h2>Blog Module</h2>
  <input type="text" id="title" placeholder="Blog Title">
  <textarea id="content" placeholder="Blog Content"></textarea>
  <button onclick="createBlog()">Create Blog</button>
  <div id="blogList"></div>
</div>

<!-- PDF SUMMARIZER -->
<div class="section hidden" id="pdf-section">
  <h2>PDF Summarizer</h2>
  <input type="file" id="pdfFile">
  <button onclick="summarizePDF()">Summarize PDF</button>
  <div id="summary"></div>
</div>

<!-- GOOGLE SCRAPER -->
<div class="section hidden" id="scraper-section">
  <h2>Google Scraper</h2>
  <input type="text" id="keyword" placeholder="Enter keyword">
  <button onclick="searchKeyword()">Search</button>
  <div id="results"></div>
</div>

<!-- LOGOUT BUTTON -->
<button onclick="logout()" id="logoutBtn" class="hidden">Logout</button>

<!-- Firebase SDKs (order matters) -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://mozilla.github.io/pdf.js/build/pdf.js"></script>

<script>
// ✅ Firebase Config (from your project settings)
const firebaseConfig = {
  apiKey: "AIzaSyDfZMceYwe9hoCk6cKO4Pi8zLsgxjXb7uc",
  authDomain: "mynetflix-1902e.firebaseapp.com",
  projectId: "mynetflix-1902e",
  storageBucket: "mynetflix-1902e.appspot.com",
  messagingSenderId: "213754965273",
  appId: "1:213754965273:web:15abebbfbc3fd95716a988",
  measurementId: "G-FHR2WTDNVZ"
};

// ✅ Initialize Firebase safely
if (!firebase.apps.length) {
  firebase.initializeApp(firebaseConfig);
}

const auth = firebase.auth();
const db = firebase.firestore();

// ✅ AUTH FUNCTIONS
function signup() {
  const email = document.getElementById("email").value.trim();
  const password = document.getElementById("password").value;
  auth.createUserWithEmailAndPassword(email, password)
    .then(userCredential => {
      alert("Signup successful! Welcome " + userCredential.user.email);
    })
    .catch(error => {
      alert("Signup Error: " + error.message);
    });
}

function login() {
  const email = document.getElementById("email").value.trim();
  const password = document.getElementById("password").value;
  auth.signInWithEmailAndPassword(email, password)
    .then(userCredential => {
      alert("Login successful! Welcome " + userCredential.user.email);
      showSections();
    })
    .catch(error => {
      if (error.code === "auth/invalid-login-credentials" ||
          error.code === "auth/wrong-password" ||
          error.code === "auth/user-not-found") {
        alert("Invalid email or password. Please check or signup first.");
      } else {
        alert("Login Error: " + error.message);
      }
    });
}

// ✅ Forgot Password Feature
function resetPassword() {
  const email = document.getElementById("email").value.trim();
  if (!email) return alert("Please enter your email first.");
  auth.sendPasswordResetEmail(email)
    .then(() => {
      alert("Password reset email sent! Check your inbox.");
    })
    .catch(error => {
      alert("Reset Error: " + error.message);
    });
}

// ✅ Logout
function logout() {
  auth.signOut().then(() => location.reload());
}

// ✅ Monitor Auth State
auth.onAuthStateChanged(user => {
  if (user) showSections();
});

// ✅ SHOW SECTIONS AFTER LOGIN
function showSections() {
  document.getElementById("auth-section").classList.add("hidden");
  document.getElementById("blog-section").classList.remove("hidden");
  document.getElementById("pdf-section").classList.remove("hidden");
  document.getElementById("scraper-section").classList.remove("hidden");
  document.getElementById("logoutBtn").classList.remove("hidden");
  loadBlogs();
}

// ✅ BLOG MODULE
function loadBlogs() {
  db.collection("blogs").orderBy("date", "desc").onSnapshot(snap => {
    const blogList = document.getElementById("blogList");
    blogList.innerHTML = "";
    snap.forEach(doc => {
      const data = doc.data();
      blogList.innerHTML += `
        <div class="blog-card">
          <h3>${data.title}</h3>
          <p>${data.content}</p>
          <small>${new Date(data.date.seconds * 1000).toLocaleString()}</small><br>
          <button onclick="editBlog('${doc.id}')">Edit</button>
          <button onclick="deleteBlog('${doc.id}')">Delete</button>
        </div>`;
    });
  });
}

function createBlog() {
  const title = document.getElementById("title").value.trim();
  const content = document.getElementById("content").value.trim();
  if (!title || !content) return alert("Title & Content required!");
  db.collection("blogs").add({
    title,
    content,
    date: firebase.firestore.Timestamp.now(),
    author: auth.currentUser.email
  }).then(() => {
    document.getElementById("title").value = "";
    document.getElementById("content").value = "";
  });
}

function editBlog(id) {
  const t = prompt("New title");
  const c = prompt("New content");
  if (t && c) db.collection("blogs").doc(id).update({ title: t, content: c });
}

function deleteBlog(id) {
  if (confirm("Are you sure?")) db.collection("blogs").doc(id).delete();
}

// ✅ PDF SUMMARIZER
async function summarizePDF() {
  const file = document.getElementById("pdfFile").files[0];
  if (!file) return alert("Select PDF!");
  const ab = await file.arrayBuffer();
  const pdf = await pdfjsLib.getDocument({ data: ab }).promise;
  let text = "";
  for (let i = 1; i <= pdf.numPages; i++) {
    const page = await pdf.getPage(i);
    const content = await page.getTextContent();
    text += content.items.map(item => item.str).join(" ") + "\n";
  }
  document.getElementById("summary").innerText =
    "PDF text length: " + text.length + " characters";
}

// ✅ GOOGLE SCRAPER (replace URL with your Cloud Function)
function searchKeyword() {
  const keyword = document.getElementById("keyword").value.trim();
  if (!keyword) return alert("Enter keyword!");
  fetch(`https://us-central1-yourproject.cloudfunctions.net/search?query=${encodeURIComponent(keyword)}`)
    .then(res => res.json())
    .then(data => {
      const results = document.getElementById("results");
      results.innerHTML = "";
      data.results.forEach(item => {
        results.innerHTML += `<p><a href="${item.link}" target="_blank">${item.title}</a></p>`;
      });
    })
    .catch(err => alert("Error fetching results: " + err.message));
}
</script>

</body>
</html>
